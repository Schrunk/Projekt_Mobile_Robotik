# Makefile fÃ¼r ROS 2 Minimal-Publisher (rclcpp + std_msgs)
# Nutzung: im Root eines ROS 2 Workspace (mit Unterordner 'src/') ausfÃ¼hren.
# Targets:
#   make scaffold  - Erstellt Paket + Beispielcode + CMakeLists
#   make build     - Baut das Paket mit colcon
#   make run       - Startet den Publisher
#   make clean     - LÃ¶scht build/install/log
#   make help      - Hilfe

SHELL := /bin/bash

# Paket-/Node-Namen
PKG_NAME := pong_game
NODE_NAME := pong_game

# Workspace-Verzeichnisse
WS_ROOT := $(CURDIR)
SRC_DIR := $(WS_ROOT)/src
PKG_DIR := $(SRC_DIR)/$(PKG_NAME)

# PrÃ¼fe Tools
check-deps:
	@command -v ros2 >/dev/null 2>&1 || { echo "âŒ 'ros2' nicht gefunden. Bitte ROS 2 Umgebung sourcen (z.B. source /opt/ros/humble/setup.bash)"; exit 1; }
	@command -v colcon >/dev/null 2>&1 || { echo "âŒ 'colcon' nicht gefunden. Bitte colcon installieren/sourcen."; exit 1; }
	@echo "âœ… AbhÃ¤ngigkeiten gefunden."

# Bauen des Pakets
build: check-deps
	@echo "ğŸ”§ Baue Paket $(PKG_NAME) ..."
	@cd "$(WS_ROOT)" && colcon build --packages-select $(PKG_NAME) $(NODE_NAME)
	@echo "âœ… Build abgeschlossen."

# Publisher starten
run:
	@echo "ğŸš€ Starte $(PKG_NAME)/$(NODE_NAME) ..."
	@bash -c "source \"$(CURDIR)/install/setup.bash\" && ros2 run $(PKG_NAME) $(NODE_NAME)"

# Sauber aufrÃ¤umen
clean:
	@echo "ğŸ§¹ LÃ¶sche build/install/log ..."
	@rm -rf "$(WS_ROOT)/build" "$(WS_ROOT)/install" "$(WS_ROOT)/log"
	@echo "âœ… Clean abgeschlossen."

help:
	@echo "ğŸ“– Makefile-Hilfe (ROS 2 Minimal-Publisher)"
	@echo "make build     - Paket bauen (colcon)"
	@echo "make run       - Publisher starten"
	@echo "make clean     - build/install/log lÃ¶schen"
	@echo "make check-deps- AbhÃ¤ngigkeiten prÃ¼fen"